{"version":3,"file":"Packages-CnLU8dnO.js","sources":["../../src/routes/Packages.tsx"],"sourcesContent":["import type { SerializedError, } from '@reduxjs/toolkit';\nimport type { FetchBaseQueryError, } from '@reduxjs/toolkit/query';\nimport type { SearchResult, } from 'minisearch';\nimport React, { useCallback, useEffect, useState, } from 'react';\nimport { useTranslation, } from 'react-i18next';\nimport { useParams, } from 'react-router-dom';\n\nimport { useCaskQuery, useFormulaQuery, useIngredientsQuery, useSearchQuery, useSearchChocoQuery, } from '../apis';\nimport { Catalogue, CatalogueItem, } from '../components/Catalogue';\nimport { DetailsView, } from '../components/DetailsView';\nimport { HOMEBREW_REFRESH_INTERVAL, INGREDIENT_CATEGORIES, MIN_SEARCH_LENGTH, RECIPE_COMMANDS, } from '../constants';\nimport { useAppDispatch, useAppSelector, } from '../hooks';\nimport type { Ingredient, } from '../models';\nimport { addIngredient, removeIngredient, } from '../states';\nimport { handleError, } from '../utils';\n\nexport const Packages = () => {\n    const { platform, } = useParams();\n\n    const [ query,                 setQuery,                 ] = useState('');\n    const [ downloadedIngredients, setDownloadedIngredients, ] = useState<Ingredient[]>([]);\n\n    const { product, } : { product : 'win/packages' | 'mac/packages' | 'tweaks', } = useAppSelector(state => state.preference);\n\n    const { ingredients, } : { ingredients : Ingredient[], } = useAppSelector(state => state.recipe);\n\n    const { data : suggestedIngredients, error : ingredientsError, } = useIngredientsQuery(undefined, {\n        pollingInterval : HOMEBREW_REFRESH_INTERVAL,\n    });\n\n    const { data : caskData, error : caskError, } = useCaskQuery(undefined, {\n        skip            : platform === 'win',\n        pollingInterval : HOMEBREW_REFRESH_INTERVAL,\n    });\n\n    const { data : formulaData, error : formulaError, } = useFormulaQuery(undefined, {\n        skip            : platform === 'win',\n        pollingInterval : HOMEBREW_REFRESH_INTERVAL,\n    });\n\n    const { data : searchData, error : searchError, isFetching : searchFetching, isLoading : searchLoading, } = useSearchQuery(query, {\n        skip : platform === 'win' || query.length < MIN_SEARCH_LENGTH,\n    });\n\n    const { data : chocoData, error : chocoError, isFetching : chocoFetching, isLoading : chocoLoading, } = useSearchChocoQuery(query, {\n        skip : platform === 'mac' || query.length < MIN_SEARCH_LENGTH,\n    });\n\n    const dispatch = useAppDispatch();\n\n    const { t, } = useTranslation();\n\n    const searchResultMapper = useCallback((result : SearchResult) => ({\n        id          : result.id,\n        name        : result.name,\n        description : result.description,\n        imageUrl    : result.imageUrl,\n        infoUrl     : result.infoUrl,\n        author      : result.author,\n        source      : result.source,\n    }), []);\n\n    const handleSearch = (keywords? : string) => setQuery(keywords ?? '');\n\n    const handleSelectionChange = useCallback((ingredient : Ingredient, selected : boolean) => dispatch(selected ? addIngredient(ingredient) : removeIngredient(ingredient)), [ dispatch, ]);\n\n    const renderCatalogueItem = useCallback((ingredient : Ingredient) => (\n        <CatalogueItem\n            key={ingredient.id}\n            selected={ingredients.some(item => item.id === ingredient.id)}\n            item={ingredient}\n            detailsView={\n                <DetailsView\n                    color={product === 'win/packages' ? 'info' : 'primary'}\n                    description={ingredient.description}\n                    infoUrl={ingredient.infoUrl}\n                    source={ingredient.source} />\n            }\n            onSelectionChange={handleSelectionChange} />\n    ), [ product, handleSelectionChange, ingredients, ]);\n\n    const handleApiError = useCallback((error? : FetchBaseQueryError | SerializedError) => {\n        if (error) {\n            if ('status' in error && (error.status === 404 || error.status === 'FETCH_ERROR' || error.status === 'TIMEOUT_ERROR')) {\n                console.error(error);\n            } else {\n                handleError(error);\n            }\n        }\n    }, []);\n\n    useEffect(() => {\n        const newDownloadedIngredients : Ingredient[] = [];\n\n        if (caskData) newDownloadedIngredients.push(...caskData.map(item => ({\n            ...item,\n            id : `${item.source}/${item.id}`,\n        })));\n\n        if (formulaData) newDownloadedIngredients.push(...formulaData.map(item => ({\n            ...item,\n            id : `${item.source}/${item.id}`,\n        })));\n\n        if (searchData) newDownloadedIngredients.push(...searchData.map(item => ({\n            ...item,\n            id : `${item.source}/${item.id}`,\n        })));\n\n        if (chocoData) newDownloadedIngredients.push(...chocoData.map(item => ({\n            ...item,\n            id : `${item.source}/${item.id}`,\n        })));\n\n        setDownloadedIngredients(newDownloadedIngredients);\n    }, [ caskData, formulaData, searchData, chocoData, ]);\n\n    useEffect(() => {\n        handleApiError(ingredientsError);\n        handleApiError(caskError);\n        handleApiError(formulaError);\n        handleApiError(searchError);\n        handleApiError(chocoError);\n    }, [ handleApiError, ingredientsError, caskError, formulaError, searchError, chocoError, ]);\n\n    return (\n        <Catalogue\n            searching={searchFetching || searchLoading || chocoFetching || chocoLoading}\n            suggestedItems={(suggestedIngredients ?? []).filter(ingredient => platform === 'win' ? ingredient.source === 'Chocolatey' : ingredient.source === 'Homebrew' || ingredient.source === 'Homebrew (Cask)' || ingredient.source === 'App Store')}\n            downloadedItems={downloadedIngredients}\n            tagLine={product === 'win/packages' ? t('packages.tagline.win') : t('packages.tagline.mac')}\n            searchHint={t('packages.search.hint')}\n            title={t('packages.about.title')}\n            description={product === 'win/packages' ? t('packages.about.description.win') : t('packages.about.description.mac')}\n            commands={RECIPE_COMMANDS}\n            categories={INGREDIENT_CATEGORIES}\n            itemFields={[\n                'id',\n                'name',\n                'description',\n                'imageUrl',\n                'infoUrl',\n                'author',\n                'source',\n            ]}\n            loadingMessage={t('packages.loading')}\n            renderCatalogueItem={renderCatalogueItem}\n            searchResultMapper={searchResultMapper}\n            onSearch={handleSearch} />\n    );\n};\n"],"names":["Packages","platform","useParams","query","setQuery","useState","downloadedIngredients","setDownloadedIngredients","product","useAppSelector","state","ingredients","suggestedIngredients","ingredientsError","useIngredientsQuery","HOMEBREW_REFRESH_INTERVAL","caskData","caskError","useCaskQuery","formulaData","formulaError","useFormulaQuery","searchData","searchError","searchFetching","searchLoading","useSearchQuery","MIN_SEARCH_LENGTH","chocoData","chocoError","chocoFetching","chocoLoading","useSearchChocoQuery","dispatch","useAppDispatch","useTranslation","searchResultMapper","useCallback","result","handleSearch","keywords","handleSelectionChange","ingredient","selected","addIngredient","removeIngredient","renderCatalogueItem","jsx","CatalogueItem","item","DetailsView","handleApiError","error","handleError","useEffect","newDownloadedIngredients","Catalogue","RECIPE_COMMANDS","INGREDIENT_CATEGORIES"],"mappings":"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"}